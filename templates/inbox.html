<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inbox - CumApp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-blue-600 text-white shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-3">
                <a class="text-xl font-bold" href="/dashboard">
                    <i class="fas fa-sms mr-2"></i>CumApp
                </a>
                <div class="hidden md:flex items-center space-x-4">
                    <a class="px-3 py-2 rounded-md hover:bg-blue-700" href="/dashboard"><i class="fas fa-home mr-1"></i>Dashboard</a>
                    <a class="px-3 py-2 rounded-md hover:bg-blue-700" href="/services"><i class="fas fa-list mr-1"></i>Services</a>
                    <a class="px-3 py-2 rounded-md hover:bg-blue-700" href="/verifications"><i class="fas fa-check-circle mr-1"></i>Verifications</a>
                    <a class="px-3 py-2 rounded-md hover:bg-blue-700" href="/numbers"><i class="fas fa-phone mr-1"></i>Numbers</a>
                    <a class="px-3 py-2 rounded-md hover:bg-blue-700" href="/communication"><i class="fas fa-comments mr-1"></i>Communication</a>
                    <a class="px-3 py-2 rounded-md bg-blue-700 relative" href="/inbox">
                        <i class="fas fa-inbox mr-1"></i>Inbox
                        <span class="absolute top-0 right-0 -mt-1 -mr-1 px-2 py-1 bg-red-500 text-white rounded-full text-xs" id="inboxBadge" style="display: none;">0</span>
                    </a>
                </div>
                <div class="hidden md:flex items-center">
                    <div class="relative">
                        <button class="px-3 py-2 rounded-md hover:bg-blue-700 flex items-center" onclick="toggleDropdown()"><i class="fas fa-user mr-1"></i><span id="userEmail">User</span><i class="fas fa-caret-down ml-2"></i></button>
                        <div id="dropdownMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" onclick="logout()"><i class="fas fa-sign-out-alt mr-2"></i>Logout</a>
                        </div>
                    </div>
                </div>
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
                </div>
            </div>
            <div id="mobileMenu" class="hidden md:hidden">
                <a class="block px-3 py-2 rounded-md hover:bg-blue-700" href="/dashboard"><i class="fas fa-home mr-1"></i>Dashboard</a>
                <a class="block px-3 py-2 rounded-md hover:bg-blue-700" href="/services"><i class="fas fa-list mr-1"></i>Services</a>
                <a class="block px-3 py-2 rounded-md hover:bg-blue-700" href="/verifications"><i class="fas fa-check-circle mr-1"></i>Verifications</a>
                <a class="block px-3 py-2 rounded-md hover:bg-blue-700" href="/numbers"><i class="fas fa-phone mr-1"></i>Numbers</a>
                <a class="block px-3 py-2 rounded-md hover:bg-blue-700" href="/communication"><i class="fas fa-comments mr-1"></i>Communication</a>
                <a class="block px-3 py-2 rounded-md bg-blue-700 relative" href="/inbox">
                    <i class="fas fa-inbox mr-1"></i>Inbox
                    <span class="absolute top-0 left-0 ml-6 -mt-1 px-2 py-1 bg-red-500 text-white rounded-full text-xs" id="inboxBadgeMobile" style="display: none;">0</span>
                </a>
                <a href="#" class="block px-3 py-2 rounded-md hover:bg-blue-700" onclick="logout()"><i class="fas fa-sign-out-alt mr-2"></i>Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-4 px-4">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h2 class="text-2xl font-bold"><i class="fas fa-inbox mr-2"></i>Inbox</h2>
                <p class="text-gray-500">Manage your messages and verification codes</p>
            </div>
            <div>
                <button class="px-4 py-2 rounded-md bg-blue-500 text-white mr-2" onclick="markAllAsRead()">
                    <i class="fas fa-check-double mr-1"></i>Mark all as read
                </button>
                <button class="px-4 py-2 rounded-md border border-blue-500 text-blue-500" onclick="refreshMessages()">
                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                </button>
            </div>
        </div>

        <div class="flex flex-wrap -mx-2">
            <!-- Message List -->
            <div class="w-full lg:w-1/3 px-2">
                <div class="bg-white rounded-lg shadow-md">
                    <div class="p-4 border-b">
                        <h5 class="font-bold mb-0">Messages</h5>
                    </div>
                    <div class="p-0" style="max-height: 600px; overflow-y: auto;">
                        <div id="messagesList">
                            <div class="text-center text-gray-500 py-4">
                                <i class="fas fa-spinner fa-spin fa-2x"></i>
                                <p>Loading messages...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message Details -->
            <div class="w-full lg:w-2/3 px-2">
                <div class="bg-white rounded-lg shadow-md">
                    <div class="p-4 border-b">
                        <h5 class="font-bold mb-0" id="messageDetailTitle">Message Details</h5>
                    </div>
                    <div class="p-4" id="messageDetailBody">
                        <div class="text-center text-gray-500 py-20">
                            <i class="fas fa-mouse-pointer fa-3x mb-3"></i>
                            <p>Click on a message from the list to view its details</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock data
        let currentMessages = [
            {
                id: 'm1',
                type: 'verification_code',
                service: 'WhatsApp',
                content: 'Your WhatsApp code is: 123456',
                timestamp: new Date().toISOString(),
                read: false,
                from: '+1234567890'
            },
            {
                id: 'm2',
                type: 'conversation',
                service: 'Conversation',
                content: 'Hello, how are you?',
                timestamp: new Date().toISOString(),
                read: true,
                from: '+1234567891'
            }
        ];

        function renderMessages() {
            const messagesList = document.getElementById('messagesList');
            messagesList.innerHTML = currentMessages.map(message => `
                <div class="p-4 border-b cursor-pointer hover:bg-gray-100 ${!message.read ? 'font-bold' : ''}" onclick="showMessageDetail('${message.id}')">
                    <div class="flex justify-between">
                        <p class="truncate">${message.content}</p>
                        <span class="text-xs text-gray-500">${new Date(message.timestamp).toLocaleTimeString()}</span>
                    </div>
                    <div class="text-xs text-gray-500">
                        <span>From: ${message.from}</span>
                        <span class="ml-2 px-2 py-1 bg-gray-200 rounded-full text-xs">${message.service}</span>
                    </div>
                </div>
            `).join('');
        }

        function showMessageDetail(messageId) {
            const message = currentMessages.find(m => m.id === messageId);
            if (!message) return;

            message.read = true;
            renderMessages();

            const messageDetailTitle = document.getElementById('messageDetailTitle');
            const messageDetailBody = document.getElementById('messageDetailBody');

            messageDetailTitle.innerText = `Message from ${message.from}`;
            messageDetailBody.innerHTML = `
                <div>
                    <p class="text-gray-500 text-sm">${new Date(message.timestamp).toLocaleString()}</p>
                    <p class="mt-4">${message.content}</p>
                </div>
            `;
        }

        function markAllAsRead() {
            currentMessages.forEach(m => m.read = true);
            renderMessages();
        }

        function refreshMessages() {
            // Here you would fetch new messages from the server
            renderMessages();
        }

        function toggleDropdown() {
            document.getElementById('dropdownMenu').classList.toggle('hidden');
        }

        function toggleMobileMenu() {
            document.getElementById('mobileMenu').classList.toggle('hidden');
        }
        
        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/login';
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderMessages();
        });
    </script>
</body>
</html>
